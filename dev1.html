<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitShard | Infinite Storage Architecture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        gray: {
                            850: '#1f2937',
                            900: '#111827',
                            950: '#030712',
                        },
                        accent: {
                            500: '#3b82f6',
                            600: '#2563eb',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar for Terminal */
        .terminal-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .terminal-scroll::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        .terminal-scroll::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        .terminal-scroll::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }
        .glass-panel {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(75, 85, 99, 0.4);
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 font-sans min-h-screen flex flex-col selection:bg-accent-500 selection:text-white overflow-x-hidden">

    <!-- Navbar -->
    <nav class="border-b border-gray-800 bg-gray-900/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg">
                    <i class="fa-brands fa-github"></i>
                </div>
                <span class="font-bold text-xl tracking-tight">Git<span class="text-blue-500">Shard</span></span>
                <span class="ml-2 px-2 py-0.5 rounded text-xs bg-gray-800 border border-gray-700 text-gray-400 font-mono">v1.0.4-beta</span>
            </div>
            <div class="flex items-center gap-6 text-sm font-medium text-gray-400">
                <div class="hidden md:flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    System Operational
                </div>
                <div class="hidden md:block">Active Shards: <span id="total-shards-count" class="text-white">1</span></div>
                <a href="#" class="hover:text-white transition-colors"><i class="fa-regular fa-circle-question text-lg"></i></a>
                <div class="w-8 h-8 rounded-full bg-gray-800 border border-gray-700 flex items-center justify-center">
                    <i class="fa-solid fa-user text-xs"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- LEFT COLUMN: Upload & System Logs (Interactive) -->
        <div class="lg:col-span-7 flex flex-col gap-6">
            
            <!-- Intro -->
            <div>
                <h1 class="text-3xl font-bold text-white mb-2">Deploy to Infinite Storage</h1>
                <p class="text-gray-400">Upload files seamlessly. The system automatically handles repository creation, sharding, and GitHub Pages deployment.</p>
            </div>

            <!-- Upload Area -->
            <div id="upload-zone" class="glass-panel rounded-xl p-8 border border-dashed border-gray-700 hover:border-blue-500 transition-all duration-300 group cursor-pointer relative overflow-hidden">
                <div class="absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                
                <div class="flex flex-col items-center justify-center text-center gap-4 relative z-10">
                    <div class="w-16 h-16 rounded-full bg-gray-800 group-hover:bg-blue-900/50 flex items-center justify-center transition-colors mb-2">
                        <i class="fa-solid fa-cloud-arrow-up text-3xl text-blue-500"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white group-hover:text-blue-400 transition-colors">Click to upload or drag and drop</h3>
                        <p class="text-sm text-gray-500 mt-1">SVG, PNG, JPG or GIF (max. 10MB per file demo)</p>
                    </div>
                    <input type="file" id="file-input" class="hidden" multiple accept="image/*">
                </div>
            </div>

            <!-- Backend Terminal Simulation -->
            <div class="glass-panel rounded-xl border border-gray-800 flex flex-col h-[400px]">
                <div class="px-4 py-3 border-b border-gray-800 bg-gray-900/50 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fa-solid fa-terminal text-gray-500 text-sm"></i>
                        <span class="text-sm font-mono text-gray-300">Backend System Logs</span>
                    </div>
                    <div class="flex gap-1.5">
                        <div class="w-2.5 h-2.5 rounded-full bg-gray-700"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-gray-700"></div>
                    </div>
                </div>
                <div id="terminal-content" class="p-4 font-mono text-xs md:text-sm text-gray-300 overflow-y-auto terminal-scroll flex-grow space-y-1">
                    <div class="text-gray-500">--- System Initialized ---</div>
                    <div class="text-gray-500">Waiting for incoming requests...</div>
                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN: Infrastructure Visualization -->
        <div class="lg:col-span-5 flex flex-col gap-6">
            
            <!-- Active Repository Status -->
            <div class="glass-panel rounded-xl p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <i class="fa-solid fa-server text-6xl text-white"></i>
                </div>
                
                <h3 class="text-sm uppercase tracking-wider text-gray-500 font-semibold mb-4">Current Active Node</h3>
                
                <div class="flex items-center justify-between mb-2">
                    <span id="active-repo-name" class="text-xl font-bold font-mono text-white">storage-shard-001</span>
                    <span id="repo-status-badge" class="px-2 py-0.5 rounded text-xs font-bold bg-green-500/20 text-green-400 border border-green-500/30">ACTIVE</span>
                </div>

                <!-- Progress Bar -->
                <div class="relative w-full h-4 bg-gray-800 rounded-full overflow-hidden mb-2">
                    <div id="repo-progress" class="absolute top-0 left-0 h-full bg-gradient-to-r from-blue-600 to-cyan-400 transition-all duration-500" style="width: 85%;"></div>
                    <!-- Threshold Line -->
                    <div class="absolute top-0 right-0 h-full w-[1px] bg-red-500 z-10" title="1GB Limit"></div>
                </div>
                
                <div class="flex justify-between text-xs font-mono text-gray-400">
                    <span id="repo-used">850 MB</span>
                    <span>1000 MB (Hard Limit)</span>
                </div>

                <div class="mt-6 pt-6 border-t border-gray-800 grid grid-cols-2 gap-4">
                    <div>
                        <span class="block text-xs text-gray-500 mb-1">Total Files</span>
                        <span id="total-files" class="text-lg font-bold text-white">423</span>
                    </div>
                    <div>
                        <span class="block text-xs text-gray-500 mb-1">Latency</span>
                        <span class="text-lg font-bold text-green-400">~120ms</span>
                    </div>
                </div>
            </div>

            <!-- Repository Topology (Visualizing Shards) -->
            <div class="glass-panel rounded-xl p-6 flex-grow">
                <h3 class="text-sm uppercase tracking-wider text-gray-500 font-semibold mb-4">Infrastructure Topology</h3>
                <div id="shards-container" class="space-y-3">
                    <!-- Shard 1 (Full) - Created by JS -->
                </div>
                
                <!-- Legend -->
                <div class="mt-6 pt-4 border-t border-gray-800 flex flex-wrap gap-3 text-xs text-gray-400">
                    <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-red-500"></span> Full/Archived</div>
                    <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-green-500"></span> Active</div>
                    <div class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full bg-gray-700"></span> Empty</div>
                </div>
            </div>

        </div>

        <!-- Recent Uploads Section -->
        <div class="lg:col-span-12 mt-4">
             <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                <i class="fa-solid fa-photo-film text-blue-500"></i> Recent Deployments
            </h3>
            <div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <!-- Mock Image 1 -->
                <div class="aspect-square bg-gray-900 rounded-lg border border-gray-800 flex items-center justify-center text-gray-600 relative group overflow-hidden">
                    <img src="https://api.dicebear.com/7.x/shapes/svg?seed=Github" alt="Placeholder" class="w-full h-full object-cover opacity-50 group-hover:opacity-100 transition-opacity">
                    <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                        <a href="#" class="text-xs text-white bg-blue-600 px-3 py-1 rounded-full hover:bg-blue-500">View on Pages</a>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- JS Logic -->
    <script>
        // --- State Management ---
        const state = {
            currentShardIndex: 1,
            currentUsageMB: 850,
            maxUsageMB: 1000,
            totalFiles: 423,
            shards: [
                { id: 1, name: 'storage-shard-001', status: 'active', usage: 850 }
            ]
        };

        // --- DOM Elements ---
        const dropZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('file-input');
        const terminal = document.getElementById('terminal-content');
        const repoNameEl = document.getElementById('active-repo-name');
        const repoProgressEl = document.getElementById('repo-progress');
        const repoUsedEl = document.getElementById('repo-used');
        const shardsContainer = document.getElementById('shards-container');
        const galleryGrid = document.getElementById('gallery-grid');
        const totalFilesEl = document.getElementById('total-files');
        const totalShardsEl = document.getElementById('total-shards-count');
        const statusBadge = document.getElementById('repo-status-badge');

        // --- Initialization ---
        renderShards();
        updateActiveRepoUI();

        // --- Event Listeners ---
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-500', 'bg-blue-900/10');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('border-blue-500', 'bg-blue-900/10');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-900/10');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // --- Core Logic ---

        function handleFiles(files) {
            if (files.length === 0) return;
            
            Array.from(files).forEach(file => {
                simulateBackendProcess(file);
            });
        }

        async function simulateBackendProcess(file) {
            const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
            
            // 1. Log Receipt
            log(`[API] Received POST request: ${file.name} (${fileSizeMB} MB)`);
            await wait(600);

            // 2. Check Database
            log(`[DB] Querying active repository...`);
            await wait(400);
            
            const projectedUsage = state.currentUsageMB + parseFloat(fileSizeMB) + 50; // +50 is dummy weight to fill bar faster for demo

            // 3. Logic Check
            if (projectedUsage >= state.maxUsageMB) {
                // SCENARIO B: OVERFLOW
                log(`[SYSTEM] ⚠️ Alert: ${state.shards[state.shards.length-1].name} Capacity Exceeded!`, 'text-red-400');
                await wait(800);
                
                await executeSpilloverProtocol();
            } else {
                // SCENARIO A: NORMAL UPLOAD
                log(`[SYSTEM] Active Node '${state.shards[state.shards.length-1].name}' has sufficient space.`);
            }

            await wait(500);

            // 4. Uploading
            log(`[GITHUB API] PUT /repos/${state.shards[state.shards.length-1].name}/contents/${file.name}...`);
            await wait(1500); // Simulate upload time

            // 5. Success
            log(`[GITHUB API] ✅ 201 Created. Commit SHA: ${generateRandomSHA()}`, 'text-green-400');
            
            // Update State
            state.currentUsageMB += (parseFloat(fileSizeMB) + 50); // Artificial boost for demo
            state.totalFiles++;
            state.shards[state.shards.length-1].usage = state.currentUsageMB;
            
            updateActiveRepoUI();
            renderShards();
            addToGallery(file);
            
            log(`[DEPLOY] Triggering GitHub Pages build... (Est. 60s)`);
            log(`[RESPONSE] Returning URL: https://user.github.io/${state.shards[state.shards.length-1].name}/${file.name}`, 'text-blue-400');
            log('------------------------------------------------');
        }

        async function executeSpilloverProtocol() {
            log(`[PROTOCOL] Initiating Shard Spillover...`, 'text-purple-400');
            
            // 1. Mark Old Full
            const oldRepo = state.shards[state.shards.length-1];
            oldRepo.status = 'full';
            log(`[DB] Marking '${oldRepo.name}' as FULL (Read-Only).`);
            
            // 2. Create New
            const newId = state.shards.length + 1;
            const newName = `storage-shard-00${newId}`;
            
            log(`[GITHUB API] POST /user/repos { name: "${newName}" }`);
            await wait(1200);
            log(`[GITHUB API] Repository created successfully.`);
            
            // 3. Enable Pages
            log(`[GITHUB API] POST /repos/${newName}/pages (Enable Hosting)`);
            await wait(1000);
            log(`[GITHUB API] GitHub Pages enabled.`);
            
            // 4. Update State
            state.shards.push({ id: newId, name: newName, status: 'active', usage: 0 });
            state.currentUsageMB = 0;
            state.currentShardIndex = newId;
            
            log(`[DB] New Active Node: '${newName}' registered.`, 'text-green-400');
            updateActiveRepoUI();
            renderShards();
        }

        // --- UI Rendering Helpers ---

        function updateActiveRepoUI() {
            const currentRepo = state.shards[state.shards.length-1];
            
            repoNameEl.innerText = currentRepo.name;
            repoNameEl.classList.add('animate-pulse');
            setTimeout(() => repoNameEl.classList.remove('animate-pulse'), 500);

            const percentage = Math.min((state.currentUsageMB / state.maxUsageMB) * 100, 100);
            repoProgressEl.style.width = `${percentage}%`;
            repoUsedEl.innerText = `${Math.floor(state.currentUsageMB)} MB`;
            totalFilesEl.innerText = state.totalFiles;
            totalShardsEl.innerText = state.shards.length;

            // Visual warning colors
            if(percentage > 90) {
                repoProgressEl.className = "absolute top-0 left-0 h-full bg-red-500 transition-all duration-500";
                statusBadge.className = "px-2 py-0.5 rounded text-xs font-bold bg-red-500/20 text-red-400 border border-red-500/30 animate-pulse";
                statusBadge.innerText = "CRITICAL";
            } else {
                repoProgressEl.className = "absolute top-0 left-0 h-full bg-gradient-to-r from-blue-600 to-cyan-400 transition-all duration-500";
                statusBadge.className = "px-2 py-0.5 rounded text-xs font-bold bg-green-500/20 text-green-400 border border-green-500/30";
                statusBadge.innerText = "ACTIVE";
            }
        }

        function renderShards() {
            shardsContainer.innerHTML = '';
            
            // Reverse to show newest on top? Or standard list. Let's do standard list.
            state.shards.forEach(shard => {
                const percent = (shard.usage / state.maxUsageMB) * 100;
                let statusColor = shard.status === 'active' ? 'bg-green-500' : 'bg-red-500';
                let icon = shard.status === 'active' ? 'fa-hdd' : 'fa-lock';
                
                const html = `
                    <div class="flex items-center gap-3 p-3 rounded-lg bg-gray-900 border ${shard.status === 'active' ? 'border-blue-500/50' : 'border-gray-800'}">
                        <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-gray-400">
                            <i class="fa-solid ${icon}"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs font-mono text-gray-300">${shard.name}</span>
                                <span class="text-[10px] text-gray-500 uppercase">${shard.status}</span>
                            </div>
                            <div class="w-full h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full ${shard.status === 'active' ? 'bg-blue-500' : 'bg-red-500/50'}" style="width: ${percent}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                shardsContainer.insertAdjacentHTML('beforeend', html);
            });
        }

        function addToGallery(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const html = `
                    <div class="aspect-square bg-gray-900 rounded-lg border border-gray-800 relative group overflow-hidden animate-pulse">
                        <img src="${e.target.result}" class="w-full h-full object-cover opacity-60">
                        <div class="absolute bottom-0 left-0 right-0 bg-black/80 p-1 text-[10px] font-mono text-center text-blue-300">
                            Building...
                        </div>
                    </div>
                `;
                // Remove animate pulse and building text after "deployment" time
                const div = document.createElement('div');
                div.innerHTML = html;
                const newEl = div.firstElementChild;
                
                galleryGrid.insertBefore(newEl, galleryGrid.firstElementChild);
                
                // Simulate deployment finish
                setTimeout(() => {
                    newEl.classList.remove('animate-pulse');
                    newEl.querySelector('img').classList.remove('opacity-60');
                    newEl.querySelector('.bg-black\\/80').innerHTML = '<span class="text-green-400">Deployed</span>';
                }, 3000); 
            }
            reader.readAsDataURL(file);
        }

        function log(msg, colorClass = 'text-gray-300') {
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            const html = `<div class="font-mono ${colorClass}"><span class="text-gray-600 mr-2">[${time}]</span>${msg}</div>`;
            terminal.insertAdjacentHTML('beforeend', html);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function generateRandomSHA() {
            return Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10);
        }

    </script>
</body>
</html>

      
